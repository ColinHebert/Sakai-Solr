<assembly xmlns="http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.2"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.2 http://maven.apache.org/xsd/assembly-1.1.2.xsd">
    <id>tomcat-overlay</id>
    <formats>
        <format>zip</format>
    </formats>
    <includeBaseDirectory>false</includeBaseDirectory>
    <dependencySets>
        <dependencySet>
            <outputDirectory>shared/lib/</outputDirectory>
            <includes>
                <include>org.sakaiproject.search:search-api:jar:*</include>
            </includes>
            <unpack>false</unpack>
        </dependencySet>
        <dependencySet>
            <outputDirectory>webapps/</outputDirectory>
            <outputFileNameMapping>${artifact.artifactId}.${artifact.extension}</outputFileNameMapping>
            <includes>
                <include>org.sakaiproject.search:sakai-search-tool:war:*</include>
            </includes>
            <unpack>false</unpack>
        </dependencySet>
        <dependencySet>
            <outputDirectory>components/${artifact.artifactId}</outputDirectory>
            <includes>
                <include>uk.ac.ox.oucs.search.solr:solr-compatibility-pack:sakai-component:*</include>
            </includes>
            <unpack>true</unpack>
        </dependencySet>
        <!--
            Instead of maintaining a copy of spring configurations in the compatibility mode,
            copy what's already existing and use that
        -->
        <dependencySet>
            <outputDirectory>components/solr-compatibility-pack</outputDirectory>
            <includes>
                <include>uk.ac.ox.oucs.search.solr:solr-pack:sakai-component:*</include>
                <include>org.sakaiproject.search:search-pack:sakai-component:*</include>
            </includes>
            <unpackOptions>
                <includes>
                    <include>WEB-INF/*.xml</include>
                </includes>
                <excludes>
                    <exclude>WEB-INF/web.xml</exclude>
                    <exclude>WEB-INF/components.xml</exclude>
                </excludes>
            </unpackOptions>
            <unpack>true</unpack>
        </dependencySet>
    </dependencySets>
</assembly>
