<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans default-lazy-init="true">
    <bean id="uk.ac.ox.oucs.search.solr.SolrSearchService"
          class="uk.ac.ox.oucs.search.solr.SolrSearchService" init-method="init">
        <property name="triggerFunctions">
            <list/>
        </property>
        <property name="notificationService" ref="org.sakaiproject.event.api.NotificationService"/>
        <property name="searchIndexBuilder" ref="uk.ac.ox.oucs.search.solr.SolrSearchIndexBuilder"/>
        <property name="solrServer" ref="solrLookupServer"/>
        <property name="searchItemFilter">
            <bean class="uk.ac.ox.oucs.search.solr.filter.SecuritySearchFilter">
                <property name="contentProducerFactory" ref="uk.ac.ox.oucs.search.solr.ContentProducerFactory"/>
            </bean>
        </property>
        <property name="contentProducerFactory" ref="uk.ac.ox.oucs.search.solr.ContentProducerFactory"/>
    </bean>

    <bean id="uk.ac.ox.oucs.search.solr.SolrSearchIndexBuilder"
          class="uk.ac.ox.oucs.search.solr.SolrSearchIndexBuilder">
        <property name="siteService" ref="org.sakaiproject.site.api.SiteService"/>
        <property name="solrServer" ref="solrIndexingServer"/>
        <property name="searchToolRequired" value="${search.tool.required}"/>
        <property name="ignoreUserSites" value="${search.usersites.ignored}"/>
        <property name="contentProducerFactory" ref="uk.ac.ox.oucs.search.solr.ContentProducerFactory"/>
        <property name="indexQueueing" ref="uk.ac.ox.oucs.search.solr.queueing.IndexQueueing"/>
    </bean>

    <bean id="uk.ac.ox.oucs.search.solr.indexing.IndexProcesses" class="uk.ac.ox.oucs.search.solr.indexing.SolrIndexProcesses">
        <property name="contentProducerFactory" ref="uk.ac.ox.oucs.search.solr.ContentProducerFactory"/>
        <property name="siteService" ref="org.sakaiproject.site.api.SiteService"/>
        <property name="searchIndexBuilder" ref="org.sakaiproject.search.api.SearchIndexBuilder"/>
        <property name="solrServerFactory">
            <bean class="org.springframework.beans.factory.config.ObjectFactoryCreatingFactoryBean">
                <property name="targetBeanName" value="solrIndexingServer"/>
            </bean>
        </property>
    </bean>

    <bean id="uk.ac.ox.oucs.search.solr.ContentProducerFactory"
          class="uk.ac.ox.oucs.search.solr.ContentProducerFactory"/>

    <bean id="solrLookupServer" class="org.apache.solr.client.solrj.impl.HttpSolrServer">
        <constructor-arg value="${search.solr.server}"/>
    </bean>
    <alias alias="solrIndexingServer" name="solrLookupServer"/>
</beans>
